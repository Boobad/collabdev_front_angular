<div #videoContainer class="video-container" [class.active-call]="isCallActive">
  <!-- Header -->
  <div class="header">
    <div class="logo">MeetGroupe</div>
    <div class="meeting-info" *ngIf="isCallActive">
      <div class="call-duration">{{ callDuration }}</div>
      <div class="meeting-code">Code: {{ meetingCode }}</div>
    </div>
    <div class="spacer"></div>
    <div class="header-actions" *ngIf="isCallActive">
      <button class="header-btn" (click)="copyMeetingLink()" matTooltip="Copier le lien d'invitation">
        <fa-icon [icon]="icons.addUser" size="lg"></fa-icon>
      </button>
      <button class="header-btn" (click)="toggleFullscreen()">
        <span class="material-icons">fullscreen</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div #videosContainer class="video-grid">
      <!-- Remote Videos -->
      <div *ngFor="let user of remoteUsers" class="remote-video-wrapper" [class.connected]="user.videoEnabled">
        <div [id]="'remote-' + user.uid" class="video-element-container"></div>
        <div class="remote-user-info">
          <div class="user-avatar">{{ user.username?.charAt(0) }}</div>
          <div class="user-name">{{ user.username }}</div>
        </div>
      </div>

      <!-- Local Video -->
      <div class="local-video-wrapper">
        <video #localVideo autoplay playsinline muted class="video-element"></video>
        <div class="local-video-overlay" *ngIf="isVideoOff">
          <span class="material-icons">videocam_off</span>
        </div>
      </div>
    </div>

    <!-- Chat Sidebar -->
    <div class="chat-sidebar" [class.active]="showChat">
      <div class="chat-header">
        <h3>Chat</h3>
        <button class="close-chat" (click)="showChat = false">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="messages-container">
        <div *ngFor="let msg of messages" [class.my-message]="msg.isMe" class="message">
          {{ msg.text }}
        </div>
      </div>
      <div class="message-input">
        <input [(ngModel)]="newMessage" placeholder="Écrire un message..." (keyup.enter)="sendMessage()">
        <button (click)="sendMessage()">
          <span class="material-icons">send</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls-bar" *ngIf="isCallActive">
    <button class="control-btn" (click)="toggleMute()" [class.active]="isMuted">
      <fa-icon [icon]="isMuted ? icons.micMute : icons.mic" size="lg"></fa-icon>
      <span>{{ isMuted ? 'Micro off' : 'Micro on' }}</span>
    </button>

    <button class="control-btn" (click)="toggleVideo()" [class.active]="isVideoOff">
      <fa-icon [icon]="isVideoOff ? icons.videoMute : icons.video" size="lg"></fa-icon>
      <span>{{ isVideoOff ? 'Caméra off' : 'Caméra on' }}</span>
    </button>

    <button class="control-btn" (click)="toggleScreenShare()" [class.active]="isSharingScreen">
      <fa-icon [icon]="icons.screen" size="lg"></fa-icon>
      <span>{{ isSharingScreen ? 'Arrêter partage' : 'Partager écran' }}</span>
    </button>

    <button class="control-btn" (click)="showChat = !showChat">
      <span class="material-icons">chat</span>
      <span>Chat</span>
    </button>

    <button class="control-btn end-call" (click)="endCall()">
      <fa-icon [icon]="icons.endCall" size="lg"></fa-icon>
      <span>Quitter</span>
    </button>
  </div>

  <!-- Start Screen -->
  <div class="start-screen" *ngIf="!isCallActive">
    <div class="welcome-card">
      <h1>MeetGroupe Pro</h1>
      <p>Vidéoconférence professionnelle en haute qualité</p>

      <div class="action-buttons">
        <button class="start-btn" (click)="createMeeting()" [disabled]="isCreatingMeeting">
          <span class="material-icons">video_call</span>
          <span *ngIf="!isCreatingMeeting">Nouvelle réunion</span>
          <mat-spinner *ngIf="isCreatingMeeting" diameter="20"></mat-spinner>
        </button>

        <div class="or-divider"><span>OU</span></div>

        <div class="join-section">
          <input [(ngModel)]="meetingCode" placeholder="Entrez le code de réunion" class="meeting-code-input">
          <button class="join-btn" (click)="joinMeeting()" [disabled]="!meetingCode || isJoiningMeeting">
            <span *ngIf="!isJoiningMeeting">Rejoindre</span>
            <mat-spinner *ngIf="isJoiningMeeting" diameter="20"></mat-spinner>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
